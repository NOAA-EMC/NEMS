<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>NEMS: Repository Structure and Versioning</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="make-images-fit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NEMS
   &#160;<span id="projectnumber">feature/documentation@6b989eaee9</span>
   </div>
   <div id="projectbrief">This is a living document and may be updated at any time.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structure.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Repository Structure and Versioning </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>NEMS modeling applications are multi-component coupled systems that must pull together, in a systematic way, components from different locations. The NEMS AppBuilder enables users to construct a specific, versioned modeling application from a versioned set of model components and configuration files. The AppBuilder approach also helps to ensure that changes made to the different applications are coordinated as they get checked back into the NEMS repository.</p>
<p>The NEMS AppBuilder introduces two levels of configuration control: the modeling application level and the NEMS level. This split provides the model developer with full version control over all aspects of the modeling application code, while hiding many technical details about the infrastructure at the NEMS level.</p>
<p>Exposed to/changeable by the user:</p>
<ul>
<li>Version of NEMS.</li>
<li>List of external components (e.g. MOM5, CICE, ...) required by the application.</li>
<li>Version of each required external component.</li>
<li>Location of source and installation directory for NEMS and each external component.</li>
<li>Compiler and 3rd party library versions.</li>
</ul>
<p>Mostly hidden from the user:</p>
<ul>
<li>Knowledge base of how to build each of the supported external components.</li>
<li>Infrastructure to configure and build NEMS according to the information specified by the application layer.</li>
<li>Coupling system based on ESMF/NUOPC.</li>
</ul>
<h2>Repository Version Tracking </h2>
<p>NEMS uses Subversion (SVN) and Git in combination for many-component modeling systems. In this approach, the code associated with a versioned, coupled modeling system is a collection of external repository tags that are accessed through the svn:external property. External components and other external elements which reside in either other Subversion or GitHub repositories can easily be included in this process since GitHub provides subversion access to Git repository tags.</p>
<p>Both the NEMS and CESM use this approach. With the AppBuilder, each application (e.g. HYCOM-GSM-CICE, NEMSfv3gfs, ...) is under its own SVN revision controlled directory. This directory contains the application-specific AppBuilder configuration file and a number of svn:external links. It is through these links that specific revisions of every component, and NEMS itself, are checked out when the application directory is checked out. The actual source code (for each component and NEMS) then lives in its own SVN or Git repository. Appendix A shows in detail how this is done in CESM.</p>
<p>The recommended best management practice for implementing the application version control is with SVN using externals. SVN externals allow the application to point to specific versions of NEMS and specific versions of each of the external components. Only external components actually used by the application need to be referenced.</p>
<h2>Overall Repository Structure </h2>
<p>The NEMS repository is divided into three types of areas:</p>
<ul>
<li>NEMS Framework - This repository contains the mediator, build system, compset runner, and this documentation</li>
<li>model components and caps - These reside in other repositories</li>
<li>NEMS Applications - A group of repositories, one for each NEMS application. They contain Subversion Externals to the NEMS Framework, and each component.</li>
</ul>
<h2>Application Repository Directories </h2>
<p>Following the above recommendation, the application directory structure under SVN control looks like this:</p>
<ul>
<li>GSM-MOM5-CICE5<ul>
<li>GSM-MOM5-CICE5.appBuilder - application-specific AppBuilder file, listing required external components</li>
<li>... other *.appBuilder files ...</li>
<li>conf/ - build configuration files</li>
<li>modulefiles/ - <code>module</code> files to load external dependencies such as NetCDF<ul>
<li>theia/ - <code>module</code> files for Theia machine</li>
<li>wcoss.cray/ - <code>module</code> files for the Cray partition of WCOSS</li>
<li>... more platform support ...</li>
</ul>
</li>
<li>compsets/ - definition of compsets for this application</li>
<li>parm/ - small parameter files for compsets. Large files are located outside of the repository.</li>
<li>log/ - subdirectory for log files from execution and compilation. These are placed in the repository log/ directory so that they can be used to track changes, by re-using compsets as regression tests.</li>
<li>NEMS - subversion external to NEMS<ul>
<li><a class="el" href="building.html">NEMSAppBuilder</a></li>
<li><a class="el" href="building.html">GNUmakefile</a> - main entry point for build system</li>
<li><a class="el" href="running.html">NEMSCompsetRun</a></li>
<li>exe/ - Built executables are placed here</li>
<li>src/<ul>
<li><a class="el" href="building.html">incmake</a> - build system logic</li>
<li>... NEMS code located here ...</li>
</ul>
</li>
<li>test/ - Underlying implementation of the NEMS compset runner</li>
</ul>
</li>
<li>CICE - Subversion external to CICE model<ul>
<li>... CICE code located here ...</li>
</ul>
</li>
<li>MOM5 - Subversion external to MOM5 model<ul>
<li>... CICE code located here ...</li>
</ul>
</li>
<li>MOM5_CAP - Subversion external to the NUOPC CAP of MOM5<ul>
<li>... NUOPC CAP code for MOM5 located here ...</li>
</ul>
</li>
<li>... other components ...</li>
</ul>
</li>
</ul>
<p>This structure gives full control of versioning of all of the model code to the application. One can obtain the entire structure, including components, by checking out the application from Subversion. For a hypothetical <code>SomeApp</code> app, </p>
<pre class="fragment">svn co https://svnemc.ncep.noaa.gov/projects/nems/apps/SomeApp/trunk SomeApp
</pre><p>or: </p>
<pre class="fragment">git clone gerrit:SomeApp
</pre><p>This checks out everything needed to build the initial revision of the <code>SomeApp</code> application prototype from source into a directory called <code>SomeApp</code>.</p>
<p>Compilation instructions can be found in this page:</p>
<ul>
<li><a class="el" href="building.html">Compiling: NEMSAppBuilder and GNUmakefile</a></li>
</ul>
<h2>Location of the Modeling Application Directory </h2>
<p>The application directory can be located anywhere under revision control. However, most of the NCEP applications are expected to be located on the EMC SVN server. It is very simple to relocate a directory that is under SVN control to a different location at any time (or to rename it), without losing any history.</p>
<p>Newer applications can be found in VLAB Gerrit; a list is available on the NEMS Projects main page:</p>
<ul>
<li><a href="https://vlab.ncep.noaa.gov/redmine/projects/nems-projects">https://vlab.ncep.noaa.gov/redmine/projects/nems-projects</a></li>
</ul>
<p>in the lower-right corner, labeled "Subprojects."</p>
<p>For older NEMS apps, this staging area contains most applications:</p>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/nems/apps">https://svnemc.ncep.noaa.gov/projects/nems/apps</a></li>
</ul>
<p>where applications may first be placed before a final location is identified. We recommend creating the canonical trunk, tags, branches directory triplet under each application for consistency. For example, the HYCOM-GSM-CICE coupling project has an application here:</p>
<ul>
<li>/projects/nems/apps/HYCOM-GSM-CICE<ul>
<li>branches</li>
<li>tags</li>
<li>trunk</li>
</ul>
</li>
</ul>
<p>At any point in the future the HYCOM-GSM-CICE directory can be renamed and/or copied to a different location on the SVN server. None of the revision history will be lost. This setup provides a very structured approach for early development work, without committing to anything that cannot be changed in the future.</p>
<h4>Handling External Components</h4>
<p>NEMS includes some external components whose primary development repository is outside of EMC. The application level provides the necessary control over which version of a specific external component is used in the modeling application. Generally, such external components have been moved to their own repositories. For some old apps, there is a staging area:</p>
<ul>
<li><a href="https://svnemc.ncep.noaa.gov/projects/nems/external_components">https://svnemc.ncep.noaa.gov/projects/nems/external_components</a></li>
</ul>
<p>However, those externals should be moved to their own git repository as soon as possible. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
